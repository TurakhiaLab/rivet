<html>
<head>
	<script src="https://d3js.org/d3.v4.min.js"></script> 
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="static/images/rivet-icon.png"/>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<nav class="navbar navbar-expand-sm navbar-dark bg-dark" style="background-color: #f3f2fe;">
  <div class="header">
				<a href="{{ url_for('table') }}" class="navbar-brand mb-0 h0" style="font-size: 55px;">
				<img src="static/images/rivet-icon.png" width="90" height="90"/>
        RiVeT: Recombination Viewer and Tracker
				</a>
				<button
				type="button"
				data-bs-toggle="collapse"
				data-bs-target="#navbarNav"
				class="navbar-toggler"
				aria-controls="navbarNav"
				aria-expanded="false"
				aria-label="Toggle navigation"
				>
				<span class="navbar-toggler-icon"></span>
				</button>

				<div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
							<li class="nav-item active">
											<a href="{{ url_for('table') }}" class="nav-link" style="font-size: 20px;">
															Home
											</a>
							<li class="nav-item active">
											<a href="{{ url_for('breakpoints') }}" class="nav-link" style="font-size: 20px;">
															Recombination Across the Genome
											</a>
							<li class="nav-item active">
											<a href="{{ url_for('getting_started') }}" class="nav-link" style="font-size: 20px;">
															Getting Started
											</a>
              <!-- Remove upload page for now
							<li class="nav-item active">
											<a href="{{ url_for('upload') }}" class="nav-link">
															Upload your results
											</a>
              <-->
						  <li class="navbar-brand navbar-right pull-sm-right m-r-0">
											<a target="_blank" href="https://github.com/TurakhiaLab/rivet" class="fa fa-github">
										  </a>
				</div>
    </div>
</nav>


</head>
<body>

<!--Bootstrap-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>

<!--jQuery-->
<link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css"/>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>

<!-- Visualizations -->
<script src="static/app.js"></script>
<script src="static/variant_tracks.js"></script>
<script src="static/viz.js"></script>
<script src="static/utils.js"></script>
<link rel="stylesheet" href="static/styles.css"/>

  <div class="grid-container">
    <div class="grid-child vis" id="visualization">
        <div class="viz" id="tracks" style="overflow-x:auto"></div>
    </div>
  </div>

<div class="offcanvas offcanvas-start" style="width: 1000px" id="off_canvas_left" data-bs-keyboard="true" data-bs-scroll="false" data-bs-backdrop="true" tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">
  <div class="offcanvas-header">
     <div class="header-title">
        <h3 class="offcanvas-title" id="offcanvasScrollingLabel">Selected Node Descendants:</h3>
				<p style="font-weight:bold">Up to 10k descendants are displayed below. Click "Download Descendants" to download all.</p>
		 </div>
		 <div class="download_button">
					<button type="button" class="btn btn-outline-primary" id="download_descendants">Download Descendants</button>
		 </div>
		 <div class="close">
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
  </div>
  <div class="offcanvas-body" id="off_canvas_left_body" style="width: 950px">
  </div>
</div>
   </div>
    <script>

    $(document).ready(function () {
    var table = $('#datatable').DataTable({
                          pageLength: 5,
                          lengthMenu: [ 5, 10, 25, 50 ],
                          // Display table results in descending order of the recombinant ranking score (coln 15)
                          order: [[15, 'desc']],
                          autoWidth: false,
                          scrollX: true,
                          columnDefs: [
                          // Hide breakpoint interval columns from results table
                          {
                               target: 3,
                               visible: false,
                               searchable: true,
                           },
                           {
                               target: 4,
                               visible: false,
                               searchable: true,
                           },
                         ],
                       });

       $('#datatable tbody').on('click', 'tr', function () {
         var row = table.row( this ).data();
         //TODO: Get parsed input file header information ahead of time
         var data = {"recomb_id" :row[0], "breakpoint1" : row[3], "breakpoint2": row[4], "donor_id" : row[1], "acceptor_id" : row[2], "descendant": row[11]};
         var endpoints = ["/get_data"];
         $.each(endpoints, function(i,u){
         $.ajax({
         url: u,
         type: 'POST',
				 contentType: "application/json",
				 dataType: "json",
         data: JSON.stringify(data),
				 processData: false,
         success: function(response){
             $('#main').text(response)
								 console.log("RESPONSE: ", response);
														 track(response);
             }
         })  
			 });

          if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
        } else {
            table.$('tr.selected').removeClass('selected');
            $(this).addClass('selected');
        }
    });
   });

    </script>


<!-- TODO: Remove right side offcanvas panel for now, update visualization settings as more visualization interactive features added
	<button class="btn btn-secondary" id="visual_settings" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">Visualization Settings</button>

<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" data-bs-scroll="true" data-bs-keyboard="true" data-bs-backdrop="false" aria-labelledby="offcanvasRightLabel">
  <div class="offcanvas-header">
    <h3 id="offcanvasRightLabel">Visualization Settings</h3>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <div class="offcanvas-body" id="off_canvas_right_body">
					<p>Toggle between viewing all SNPS for each node and recombination-informative SNPS only (default).</p>
				 <button type="button" class="btn btn-outline-dark btn-sm" id="recomb_info_only" data-toggle="button" aria-pressed="false">
		     Show Recombination-Informative Only
	       </button>

	       <button type="button" class="btn btn-outline-dark btn-sm" id="all_snps" data-toggle="button" aria-pressed="false">
		     Show all SNPS
	       </button>
   </div>
  </div>
</div>

<-->


 <div class="container">
    <div class="row">
    <!--table id="datatable" class="table is-striped" style="width:100%"-->
    <!--table id="datatable" class="striped" style="width:100%"-->
    <table id="datatable" class="striped" style="width:100%">
				 <h2>RIPPLES Dectected Recombination Events</h2>
				 <h5>Public Tree, Last Updated: December 31, 2022</h5>
	
         <div class="download_button" id="download">
           <button type="button" class="btn btn-outline-primary" id="download_all_descendants">Download All Descendants</button>
           <button type="button" class="btn btn-outline-primary" id="download_table">Download Table</button>
         </div>

        <thead>
						<tr>
							 {% for header in headings %}
							 <th>{{ header }}</th>
							 {% endfor %}
            </tr>
        </thead>
        <tbody>
					  {% for row in data %}
                    <tr>
							          {% for cell in row %}
												    {% if not loop.last %}
												        <td class="table__cell">{{ cell }}</td>
														{% else %}
														    <td class="table__cell"> 
																				{% set tree = cell %}
																				<a target="_blank" href="{{ tree }}">
																					<div style="height:100%;width:100%">
																						View Tree
																					</div>
																				</a>
																</td>
														{% endif %}
							          {% endfor %}
                    </tr>
					  {% endfor %}

        </tbody>
				<!--TODO: For table footer, if necessary
        <tfoot>
            <tr>
							 {% for header in headings %}
							 <th>{{ header }}</th>
							 {% endfor %}
            </tr>
        </tfoot>
				<-->
    </table>
		</div>
	</div>


</body>
</html>
